<!doctype html><!--
 _____             _    _      _   _             _               
/  __ \           | |  (_)    | | | |           | |              
| /  \/ ___   ___ | | ___  ___| |_| | ___   ___ | | _____ _   _  
| |    / _ \ / _ \| |/ / |/ _ \  _  |/ _ \ / _ \| |/ / _ \ | | | 
| \__/\ (_) | (_) |   <| |  __/ | | | (_) | (_) |   <  __/ |_| | 
 \____/\___/ \___/|_|\_\_|\___\_| |_/\___/ \___/|_|\_\___|\__, | 
                                                           __/ | 
                                                          |___/ 
--><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><link rel="shortcut icon" href=/img/favicon.ico><meta name=generator content="Hugo 0.105.0"><title>DNSリークの判定方法 | CookieHookey</title><meta name=description content><meta name=robots content="index, follow"><link href=/output/css/main.c01966560d51758b10cbf219b43b872efa37a5714cd1a7754016e6c91120871d.css integrity="sha256-wBlmVg1RdYsQy/IZtDuHLvo3pXFM0ad1QBbmyREghx0=" rel=stylesheet crossorigin=anonymous><meta property="og:title" content="DNSリークの判定方法"><meta property="og:description" content="VPNのサイトでは､よくDNSリークというワードを見かける｡自分が名前解決に設定しているDNSサーバーと､リーク判定に用いるWebサイトのサーバーとは別なはずなのに､何故判定できるのか､その仕組みについて調べてみた｡
DNSとは 知っていれば､必要ない項目だけど､何となく導入として｡コミックで説明しているサイトも参考になる｡
DNSとは､Domain Name Systemのことで､ネットの通信に必要なIPアドレス(53.14.333.383など)を人間が扱いやすいドメイン(example.comなど)に置き換えて管理する仕組み｡
DNSの発想としては電話番号が近い気がする｡電話番号が電子的にデータベース化される前は､電話番号を語呂合わせで覚えていた｡それは､人が数字を覚えるのが苦手だからだ｡しかし､語呂合わせを用いれば､(0120)-489-444は､&ldquo;予約しようよ&rdquo;1で劇団四季の電話番号だとすぐ覚えられる｡電話番号の領域だけでなく､インターネット(IPアドレス)の領域でもこの語呂合わせ(置き換え)の仕組みが利用されている｡
必要な情報が202.247.61.250だとしても人間には扱いにくい｡置き換えの発想を用いると､shiki.jpとなる｡劇団四季のWebサイトなのだが､数字よりは簡単に覚えられる｡この｢202.247.61.250は､shiki.jpですよ｣という置き換えを管理する仕組みがDNSとなる｡そこで管理されるデータベースが､電話番号の場合は電話帳だが､IPアドレスの場合はDNSレコードとなる｡IPアドレスの場合､世界全体が対象なので､電話番号のように個人や企業で勝手に置き換えをしてデーターベースを作成しても共有できない｡そのため､DNSレコードを標準化し､管理する団体や､細かい仕組みというのが存在する｡
昔は､PCにホストファイルをダウンロードしてドメイン(ホスト)の管理をしていたらしいが､ドメインの数も以前とは違うので､今はDNSが主流だ｡ただ､ホストファイル(/etc/hostsなど)に記述があればDNSより優先されるようだ｡
名前解決に使用されたDNSサーバーの判定方法 本題に入る｡DNSサーバーには､大別すると2つある｡
DNSキャッシュサーバー(フルサービスリゾルバや､Recursive Resolver2) 権威サーバー(コンテンツサーバー) 通例､クライアントからキャッシュサーバーに名前解決のリクエストをして､最終的に､実際に管理している権威サーバーまで辿り着く｡そこでリクエストに対応するIPアドレスがクライアントに返される｡
この時､権威サーバーを自前で用意することで､アクセスしてきたキャッシュサーバーのIPをログできる｡WebページにアクセスしてきたVPNサーバーのIPと､名前解決に利用されたキャッシュサーバーのIPを比較し､異なっていればリーク判定となる｡
UIDを付加するとリクエストを強制できる ただ､キャッシュサーバーというのはその名の通り､レスポンスをTTLが有効である限りキャッシュしているので､タイミングによっては新たに権威サーバーにリクエストをすることはない｡そこで､UIDとしてハッシュみたいなランダムなものをサブドメインとして付け加えリクエストを強制させる｡そうすることで､使用しているキャッシュサーバーのIPをUIDとともにログできる｡
例えば､名前解決させたいドメインがtest.dnsleaktest.comの場合､特にオープンリゾルバの場合だと利用者が他にも大勢いるため､キャッシュされている可能性がある｡ところが､a0e4651af6b14311ab917.test.dnsleaktest.comとすれば､キャッシュされているわけもないので､キャッシュサーバーは名前解決をせざるを得ない｡
DNS leak testで試すと､権威サーバー(ns1.dnsleaktest.comやns2.dnsleaktest.com)から､Aレコードが返ってきた｡ただ､Mullvadの場合は､NXDOMAINとして返ってくるので､実際に存在するドメインでなくてもいいようだ｡DNSキャッシュポイズニングの手法と同じ感じで､権威サーバーへのリクエストさえ飛べば良いということなのだろう｡
数字にはいろいろ発音がある｡そのままの発音にすると､489(よん､やっつ､きゅう)､444(し､よん､よん)となるが､それをナチュラルな文法に修正して､予約しようよ(よ､や､く､し､よう､よ)になる｡数字の置き換えの発想を感じるには､語呂合わせジェネレーターが役立つかも知れないが､桁が増えると､こじつけ感は増す｡&#160;&#8617;&#xfe0e;
クライアント目線ではrecursive､キャッシュサーバー目線ではiterative&#160;&#8617;&#xfe0e;"><meta property="og:type" content="article"><meta property="og:url" content="https://cookiehookey.v6.rocks/how-does-dns-leak-detection-work/"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-04-23T00:00:00+00:00"><meta property="article:modified_time" content="2022-04-23T00:00:00+00:00"><meta property="og:site_name" content="CookieHookey"><meta itemprop=name content="DNSリークの判定方法"><meta itemprop=description content="VPNのサイトでは､よくDNSリークというワードを見かける｡自分が名前解決に設定しているDNSサーバーと､リーク判定に用いるWebサイトのサーバーとは別なはずなのに､何故判定できるのか､その仕組みについて調べてみた｡
DNSとは 知っていれば､必要ない項目だけど､何となく導入として｡コミックで説明しているサイトも参考になる｡
DNSとは､Domain Name Systemのことで､ネットの通信に必要なIPアドレス(53.14.333.383など)を人間が扱いやすいドメイン(example.comなど)に置き換えて管理する仕組み｡
DNSの発想としては電話番号が近い気がする｡電話番号が電子的にデータベース化される前は､電話番号を語呂合わせで覚えていた｡それは､人が数字を覚えるのが苦手だからだ｡しかし､語呂合わせを用いれば､(0120)-489-444は､&ldquo;予約しようよ&rdquo;1で劇団四季の電話番号だとすぐ覚えられる｡電話番号の領域だけでなく､インターネット(IPアドレス)の領域でもこの語呂合わせ(置き換え)の仕組みが利用されている｡
必要な情報が202.247.61.250だとしても人間には扱いにくい｡置き換えの発想を用いると､shiki.jpとなる｡劇団四季のWebサイトなのだが､数字よりは簡単に覚えられる｡この｢202.247.61.250は､shiki.jpですよ｣という置き換えを管理する仕組みがDNSとなる｡そこで管理されるデータベースが､電話番号の場合は電話帳だが､IPアドレスの場合はDNSレコードとなる｡IPアドレスの場合､世界全体が対象なので､電話番号のように個人や企業で勝手に置き換えをしてデーターベースを作成しても共有できない｡そのため､DNSレコードを標準化し､管理する団体や､細かい仕組みというのが存在する｡
昔は､PCにホストファイルをダウンロードしてドメイン(ホスト)の管理をしていたらしいが､ドメインの数も以前とは違うので､今はDNSが主流だ｡ただ､ホストファイル(/etc/hostsなど)に記述があればDNSより優先されるようだ｡
名前解決に使用されたDNSサーバーの判定方法 本題に入る｡DNSサーバーには､大別すると2つある｡
DNSキャッシュサーバー(フルサービスリゾルバや､Recursive Resolver2) 権威サーバー(コンテンツサーバー) 通例､クライアントからキャッシュサーバーに名前解決のリクエストをして､最終的に､実際に管理している権威サーバーまで辿り着く｡そこでリクエストに対応するIPアドレスがクライアントに返される｡
この時､権威サーバーを自前で用意することで､アクセスしてきたキャッシュサーバーのIPをログできる｡WebページにアクセスしてきたVPNサーバーのIPと､名前解決に利用されたキャッシュサーバーのIPを比較し､異なっていればリーク判定となる｡
UIDを付加するとリクエストを強制できる ただ､キャッシュサーバーというのはその名の通り､レスポンスをTTLが有効である限りキャッシュしているので､タイミングによっては新たに権威サーバーにリクエストをすることはない｡そこで､UIDとしてハッシュみたいなランダムなものをサブドメインとして付け加えリクエストを強制させる｡そうすることで､使用しているキャッシュサーバーのIPをUIDとともにログできる｡
例えば､名前解決させたいドメインがtest.dnsleaktest.comの場合､特にオープンリゾルバの場合だと利用者が他にも大勢いるため､キャッシュされている可能性がある｡ところが､a0e4651af6b14311ab917.test.dnsleaktest.comとすれば､キャッシュされているわけもないので､キャッシュサーバーは名前解決をせざるを得ない｡
DNS leak testで試すと､権威サーバー(ns1.dnsleaktest.comやns2.dnsleaktest.com)から､Aレコードが返ってきた｡ただ､Mullvadの場合は､NXDOMAINとして返ってくるので､実際に存在するドメインでなくてもいいようだ｡DNSキャッシュポイズニングの手法と同じ感じで､権威サーバーへのリクエストさえ飛べば良いということなのだろう｡
数字にはいろいろ発音がある｡そのままの発音にすると､489(よん､やっつ､きゅう)､444(し､よん､よん)となるが､それをナチュラルな文法に修正して､予約しようよ(よ､や､く､し､よう､よ)になる｡数字の置き換えの発想を感じるには､語呂合わせジェネレーターが役立つかも知れないが､桁が増えると､こじつけ感は増す｡&#160;&#8617;&#xfe0e;
クライアント目線ではrecursive､キャッシュサーバー目線ではiterative&#160;&#8617;&#xfe0e;"><meta itemprop=datePublished content="2022-04-23T00:00:00+00:00"><meta itemprop=dateModified content="2022-04-23T00:00:00+00:00"><meta itemprop=wordCount content="24"><meta itemprop=keywords content="DNS,"></head><body class="bg-body subpixel-antialiased flex flex-col h-screen justify-between tracking-wide"><div id=js-off><header class="header-cs py-3"><div class="container flex justify-between items-center flex-wrap"><div class="text-lg font-bold"><a href=/>CookieHookey</a></div><div class="flex items-center flex-wrap"><ul class="flex items-center flex-wrap"><li class=ml-4><a class=hover:text-white href=/tags title="Tags page">Tags</a></li></ul></div></div></header><main class="container mb-auto mt-5"><article><header class="text-center py-10"><h1 class="text-5xl pb-2">DNSリークの判定方法</h1><div class="flex place-content-center"><time datetime=2022-04-23T00:00:00Z>April 23, 2022</time></div></header><section class=main-article><div class=article-details><div class=article-category><a href=/categories/tech/>Tech</a></div></div><p>VPNのサイトでは､よくDNSリークというワードを見かける｡自分が名前解決に設定しているDNSサーバーと､リーク判定に用いるWebサイトのサーバーとは別なはずなのに､何故判定できるのか､その仕組みについて調べてみた｡</p><h2 id=dnsとは><a style=color:#9a9996 href=#dns%e3%81%a8%e3%81%af>DNSとは</a></h2><p>知っていれば､必要ない項目だけど､何となく導入として｡<a href=https://howdns.works/ep1/>コミックで説明しているサイト</a>も参考になる｡</p><p>DNSとは､Domain Name Systemのことで､ネットの通信に必要なIPアドレス(53.14.333.383など)を人間が扱いやすいドメイン(example.comなど)に置き換えて管理する仕組み｡</p><p>DNSの発想としては電話番号が近い気がする｡電話番号が電子的にデータベース化される前は､電話番号を語呂合わせで覚えていた｡それは､人が数字を覚えるのが苦手だからだ｡しかし､語呂合わせを用いれば､(0120)-489-444は､&ldquo;予約しようよ&rdquo;<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>で劇団四季の電話番号だとすぐ覚えられる｡電話番号の領域だけでなく､インターネット(IPアドレス)の領域でもこの語呂合わせ(置き換え)の仕組みが利用されている｡</p><p>必要な情報が202.247.61.250だとしても人間には扱いにくい｡置き換えの発想を用いると､shiki.jpとなる｡<a href=https://www.shiki.jp/>劇団四季のWebサイト</a>なのだが､数字よりは簡単に覚えられる｡この｢202.247.61.250は､shiki.jpですよ｣という置き換えを管理する仕組みがDNSとなる｡そこで管理されるデータベースが､電話番号の場合は電話帳だが､IPアドレスの場合はDNSレコードとなる｡IPアドレスの場合､世界全体が対象なので､電話番号のように個人や企業で勝手に置き換えをしてデーターベースを作成しても共有できない｡そのため､DNSレコードを標準化し､管理する団体や､細かい仕組みというのが存在する｡</p><p>昔は､PCにホストファイルをダウンロードしてドメイン(ホスト)の管理をしていたらしいが､ドメインの数も以前とは違うので､今はDNSが主流だ｡ただ､ホストファイル(/etc/hostsなど)に記述があればDNSより優先されるようだ｡</p><h2 id=名前解決に使用されたdnsサーバーの判定方法><a style=color:#9a9996 href=#%e5%90%8d%e5%89%8d%e8%a7%a3%e6%b1%ba%e3%81%ab%e4%bd%bf%e7%94%a8%e3%81%95%e3%82%8c%e3%81%9fdns%e3%82%b5%e3%83%bc%e3%83%90%e3%83%bc%e3%81%ae%e5%88%a4%e5%ae%9a%e6%96%b9%e6%b3%95>名前解決に使用されたDNSサーバーの判定方法</a></h2><p>本題に入る｡DNSサーバーには､大別すると2つある｡</p><ul><li>DNSキャッシュサーバー(フルサービスリゾルバや､Recursive Resolver<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>)</li><li>権威サーバー(コンテンツサーバー)</li></ul><p>通例､クライアントからキャッシュサーバーに名前解決のリクエストをして､最終的に､実際に管理している権威サーバーまで辿り着く｡そこでリクエストに対応するIPアドレスがクライアントに返される｡</p><p>この時､権威サーバーを自前で用意することで､アクセスしてきたキャッシュサーバーのIPをログできる｡WebページにアクセスしてきたVPNサーバーのIPと､名前解決に利用されたキャッシュサーバーのIPを比較し､異なっていればリーク判定となる｡</p><h2 id=uidを付加するとリクエストを強制できる><a style=color:#9a9996 href=#uid%e3%82%92%e4%bb%98%e5%8a%a0%e3%81%99%e3%82%8b%e3%81%a8%e3%83%aa%e3%82%af%e3%82%a8%e3%82%b9%e3%83%88%e3%82%92%e5%bc%b7%e5%88%b6%e3%81%a7%e3%81%8d%e3%82%8b>UIDを付加するとリクエストを強制できる</a></h2><p>ただ､キャッシュサーバーというのはその名の通り､レスポンスをTTLが有効である限りキャッシュしているので､タイミングによっては新たに権威サーバーにリクエストをすることはない｡そこで､UIDとしてハッシュみたいなランダムなものをサブドメインとして付け加えリクエストを強制させる｡そうすることで､使用しているキャッシュサーバーのIPをUIDとともにログできる｡</p><p>例えば､名前解決させたいドメインがtest.dnsleaktest.comの場合､特にオープンリゾルバの場合だと利用者が他にも大勢いるため､キャッシュされている可能性がある｡ところが､a0e4651af6b14311ab917.test.dnsleaktest.comとすれば､キャッシュされているわけもないので､キャッシュサーバーは名前解決をせざるを得ない｡</p><p><a href=https://www.dnsleaktest.com/>DNS leak test</a>で試すと､権威サーバー(ns1.dnsleaktest.comやns2.dnsleaktest.com)から､Aレコードが返ってきた｡ただ､<a href=https://mullvad.net/en/check/>Mullvad</a>の場合は､NXDOMAINとして返ってくるので､実際に存在するドメインでなくてもいいようだ｡DNSキャッシュポイズニングの手法と同じ感じで､権威サーバーへのリクエストさえ飛べば良いということなのだろう｡</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>数字にはいろいろ発音がある｡そのままの発音にすると､489(よん､やっつ､きゅう)､444(し､よん､よん)となるが､それをナチュラルな文法に修正して､予約しようよ(よ､や､く､し､よう､よ)になる｡数字の置き換えの発想を感じるには､<a href=https://seoi.net/goro/>語呂合わせジェネレーター</a>が役立つかも知れないが､桁が増えると､こじつけ感は増す｡&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>クライアント目線ではrecursive､キャッシュサーバー目線ではiterative&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></section><section class=tags><ul class="flex list-none mt-20 ml-0 p-0"><span class=mr-3>Tags:</span><li class="mr-3 tags-cs"><a class="px-4 py-2" href=/tags/dns>DNS</a></li></ul></section><div class=mt-20><div><h5 style=font-size:1.5rem></h5><ul><li><a href=/make-resolv-conf-immutable/>Nameserverを固定する</a></li></ul></div></div></article><input type=checkbox id=cp_navimenuid>
<label class=menu for=cp_navimenuid><div class=menubar><span class=bar></span>
<span class=bar></span>
<span class=bar></span></div><aside class=right-sidebar><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#dnsとは>DNSとは</a></li><li><a href=#名前解決に使用されたdnsサーバーの判定方法>名前解決に使用されたDNSサーバーの判定方法</a></li><li><a href=#uidを付加するとリクエストを強制できる>UIDを付加するとリクエストを強制できる</a></li></ol></nav></div></aside></label></main><footer class="container mt-20 py-10"><hr style=margin-bottom:2.5rem;width:105%;margin-left:-2.5%;margin-top:-40px><ul class="flex justify-between items-center flex-wrap"><li><a class=hover:text-white href=/about title="About page">About</a></li><li><a class=hover:text-white href=/contact title="Contact page">Contact</a></li><li><a class=hover:text-white href=/privacy title="Privacy page">Privacy</a></li><li><a class=hover:text-white href=/index.xml title="RSS page">RSS</a></li></ul><div class="py-10 search-box"><form method=get id=ddgSearch action=https://duckduckgo.com/><input type=hidden name=sites value=cookiehookey.neocities.org>
<input class=search-container style=width:90% type=text name=q placeholder="Search the site" aria-label="Search cookiehookey.neocities.org on DuckDuckGo">
<button class=search-btn type=submit>Search</button></form></div><p style=text-align:right;font-size:12px>Powered by Hugo | Theme based on photophobia</p></footer></div></body><div class=js-on id=js-on style=display:none><div id=cf-wrapper><div id=cf-error-details class=cf-error-details-wrapper><div class="cf-wrapper cf-header cf-error-overview"><h1>Please wait...</h1><h2 class=cf-subheadline><span>We are checking your browser...</span> cookiehookey.neocities.org</h2></div><div class="cf-section cf-highlight cf-captcha-container"><div class=cf-wrapper><div class="cf-columns two"><div class=cf-column><div class="cf-highlight-inverse cf-form-stacked"><form class="challenge-form managed-form" id=challenge-form><div id=cf-please-wait><div id=spinner><div id=cf-bubbles><div class=bubbles></div><div class=bubbles></div><div class=bubbles></div></div></div><p id=cf-spinner-please-wait>Please stand by, while we are checking your browser...</p></div><span id=cf-captcha-bookmark class=cf-captcha-info><h1>Please turn JavaScript off and reload the page.</h1></span></form></div></div><div class=cf-column><div class=cf-screenshot-container><span class=cf-no-screenshot></span></div></div></div></div></div><div class="cf-section cf-wrapper"><div class="cf-columns two"><div class=cf-column><h2>Why do I have to turn JavaScript off?</h2><p>Because this site doesn't require JavaScript to view this page.</p></div><div class=cf-column><h2>What can I do to prevent this in the future?</h2><p>If you enable JavaScript on by default, change it to disable by default and enable it when you really need it.</p><p>JavaScript is used, more often than not, to track your activity or used to effectively inject Malware.</p><p>The way to disable JavaScript differs from browsers to browsers, but taking Firefox as an example, using extension uBlock Origin is the handy way. <a rel="noopener noreferrer" href=https://addons.mozilla.org/en-US/firefox/addon/ublock-origin/>Firefox Add-ons Store</a>.</p></div></div></div><div class="cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300"><p class=text-13><span class="cf-footer-item sm:block sm:mb-1">Cloudflare Ray ID: <strong class=font-semibold>7qrq0gefx5ed5c6t</strong></span>
<span class="cf-footer-separator sm:hidden">•</span>
<span class="cf-footer-item sm:block sm:mb-1"><span>Performance & security not by</span> <a rel="noopener noreferrer" href=https://web.archive.org/web/20210429163415/https://forge.chapril.org/you/stop_cloudflare/src/branch/master/readme/en.md id=brand_link target=_blank>Cloudflare</a></span></p></div></div></div></div><script type=text/javascript>document.getElementById("js-off").style.display="none",document.getElementById("js-on").style.display="block",window.setTimeout(function(){document.getElementById("challenge-form").innerHTML='<img src="/img/recaptcha.jpg" alt="recaptha-like">'},1e4)</script></html>